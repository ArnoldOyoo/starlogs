generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String   @id @default(cuid())
  email       String   @unique
  username    String   @unique
  password    String
  avatar      String?
  location    String?
  preferences Json     @default("{}")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  sessions  ObservationSession[]
  favorites Favorite[]

  @@map("users")
}

model ObservationSession {
  id         String   @id @default(cuid())
  userId     String
  date       DateTime
  location   String
  conditions Json     // { seeing, transparency, cloudCover, temperature, humidity }
  equipment  String?
  notes      String?
  photos     String[] // URLs to stored images
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  user    User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  objects ObservedObject[]

  @@index([userId])
  @@index([date])
  @@map("observation_sessions")
}

model ObservedObject {
  id        String  @id @default(cuid())
  sessionId String
  name      String
  type      String  // star, planet, constellation, dso, etc.
  notes     String?
  rating    Int?    @db.SmallInt // 1-5 rating

  session ObservationSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@map("observed_objects")
}

model Favorite {
  id         String   @id @default(cuid())
  userId     String
  objectId   String   // External ID (e.g., HIP number, Messier number)
  objectName String
  objectType String   // star, planet, constellation, dso, other
  notes      String?
  createdAt  DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, objectId])
  @@index([userId])
  @@map("favorites")
}

model CelestialEvent {
  id          String   @id @default(cuid())
  name        String
  type        String   // eclipse, meteor_shower, conjunction, etc.
  date        DateTime
  endDate     DateTime?
  description String
  visibility  String   // global, northern, southern, specific regions
  importance  Int      @db.SmallInt // 1-5 rating
  createdAt   DateTime @default(now())

  @@index([date])
  @@index([type])
  @@map("celestial_events")
}
